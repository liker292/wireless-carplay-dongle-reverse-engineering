<!DOCTYPE html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta http-equiv="expires" content="0"><meta http-equiv="pragma" content="no-cache"><meta http-equiv="cache-control" content="no-cache,must-revalidate,no-store"><meta name="viewport" id="view" content="user-scalable=yes"><link rel="icon" href="data:image/ico;base64,aWNv"><link href="skin.css?t=6" rel="stylesheet" type="text/css" /><script src="lang.js?t=7" type='text/javascript' ></script></head><body onload="f_1()"><div class="div-container"><div class="div-update-content"><div class="div-update-head" id="div-update-head"><div><span id="update-head-title"></span></div><div><span id="update-head-version"></span></div></div><div id="release-notes"></div></div><div class="div-update-button" id="bottom-button"><button id="down-button" onclick="f_2()"></button><button id="menu-button" onclick="menuObject.f_3()"></button></div></div><div class="loader" id="loader"><svg class="circular" viewBox="30 30 60 60"><circle class="path" cx="60" cy="60" r="25" fill="none" stroke-width="3" stroke-miterlimit="10"></circle></svg><div id="loader-tips"></div></div><div id="dialog-upgrading" class="dialog-outer-bg"><div class="upgrade-state-dialog" id="dialog-upgrading-inner"><div class="upgradeing-anim-container"><div class="upgrading-anim"></div><div class="upgrading-text"><span>正在升级...</span></div></div><div class="upgrade-state-tips" style="font-size:1.8rem;"><span>可能比较耗时，请耐心等待</span></div></div></div><div id="dialog-upgrade-success" class="dialog-outer-bg"><div class="upgrade-state-dialog" id="dialog-upgrade-success-inner"><div class="upgrade-success"></div><div class="upgrade-state-tips"><span>升级成功</span></div></div></div><div id="dialog-upgrade-failed" class="dialog-outer-bg"><div class="upgrade-state-dialog" id="dialog-upgrade-failed-inner"><div class="div-failed"><div class="upgrade-failed"></div></div><div class="upgrade-state-tips"><span>升级失败</span></div></div></div><div id="dialog" class="dialog-outer-bg"><div id="dialog-inner"><div><span class="dialog-message" id="dialog-message">正在下载...</span></div><div class="progress round-conner"><div class="curRate round-conner" id="curRate"></div></div><div><span id="progress-percent"></span></div></div></div><div id="menu-div"><ul><li><button>打开U盘模式</button></li><li><button>打开日志</button></li><li><button onclick="LogDescDialog.f_4()">上传日志</button></li></ul></div><div id="log-desc-dlg" class="dialog-outer-bg"><div class="log-desc-dlg-inner" id="log-desc-dlg-inner"><div class="log-desc-dlg-inner-title"><span></span></div><div><textarea id="log-desc-content" rows="3" cols="20"></textarea></div><div><button onclick="f_5()"></button></div></div></div><div class="dialog-outer-bg" id="activate-dlg"><div class="activate-dlg-inner" id="activate-dlg-inner"><div class="title"><span></span></div><div class="item"><span class="tag"></span><input type="number" oninput="value=value.replace(/[^\d]/g,'')" onblur="f_6(this)"/></div><div class="item"><span class="tag"></span><select></select></div><div class="item"><span class="tag"></span><input type="text"/></div><div class="item"><span class="tag"></span><input type="password"/></div><div class="item" style="padding: 0px;"><span class="tag"></span><input type="checkbox" /><span style="height:2rem;font-size:2rem;margin-top:-0.5rem;"></span></div><div style="text-align: center;"><button onclick="f_7()"></button></div></div></div><script type="text/javascript">var g_downUrl="";var g_lang=2;var g_intervalId;var g_boxFileName="";var g_boxLogFileName="box.log";var g_boxVersion="";const UPGRADE_STATE_UNSTARTED=0;const UPGRADE_STATE_UPGRADING=1;const UPGRADE_STATE_SUCCESS =2;const UPGRADE_STATE_FAILED =3;const URL_PREFIX="http://www.paplink.cn/";var menuObject={menu: document.getElementById("menu-div"),isInit: false,f_3: function(){if(this.menu.style.display != 'block'){if(!this.isInit){document.getElementById("menu-div").children[0].children[2].children[0].innerHTML=text_UploadLog[g_lang];this.isInit=true;}this.menu.style.display='block';}else{this.menu.style.display='none';}},f_8: function(){if(this.menu.style.display != 'none'){this.menu.style.display='none';}}};var CookieUtils={f_9: function(name,value){var days=7;var exp=new Date();exp.setTime(exp.getTime()+days*24*60*60*1000);document.cookie=name+"="+decodeURI(value)+";expires="+exp.toUTCString();},f_10: function(name){var cookie=document.cookie;var start=cookie.indexOf(name+"=");if(start >= 0){start += name.length+1;var end=cookie.indexOf(";",start);if(end < 0){end=cookie.length;}var value=decodeURIComponent(cookie.substring(start,end));return [name,value];}else{return [name,""];}},f_11: function(name){var exp=new Date();exp.setTime(exp.getTime() - 1);var value=this.f_10(name);if(value != null || value[1]==''){document.cookie= name +"="+value+";expires="+exp.toGMTString();}},f_12: function(){var cookie=document.cookie;var ca=cookie.split(";");if(ca.length>0){for (var i=ca.length-1; i>=0; i--){var c=ca[i].trim();if(c.indexOf("RememberPassword") >= 0 || c.indexOf("PHPSESSID")>=0 || c.indexOf("BATCH")>=0){continue;}else{var index=c.indexOf("=");if(index>0){var name=c.substring(0,index);var pwd =c.substring(index+1,c.length);return [name,pwd];}}}}return ["",""];},f_13: function(is){this.f_9("RememberPassword",is);},f_14: function(){var is=this.f_10("RememberPassword");if(is != null){if(is[1]=="true"){return true;}}return false;},};const UpgradingDialog={is_init: false,dialog: document.getElementById("dialog-upgrading"),dialogInner: document.getElementById("dialog-upgrading-inner"),f_4: function(){if(!this.is_init){this.dialog.style.setProperty("display","block");var titleSpan=this.dialog.getElementsByTagName("span")[0];titleSpan.innerHTML=text_Upgrading[g_lang];var tipsSpan=this.dialog.getElementsByTagName("span")[1];tipsSpan.innerHTML=text_UpgradingTips[g_lang];var h=0.5*(this.dialog.offsetHeight - this.dialogInner.offsetHeight);var w=0.5*(this.dialog.offsetWidth - this.dialogInner.offsetWidth);this.dialogInner.style.setProperty('left',w+'px');this.dialogInner.style.setProperty('top',h+'px');this.is_init=true;}else{this.dialog.style.setProperty("display","block");}},f_8: function(){this.dialog.style.setProperty("display","none");}};const UpgradeSuccessDialog={is_init: false,dialog: document.getElementById("dialog-upgrade-success"),dialogInner: document.getElementById("dialog-upgrade-success-inner"),f_4: function(){if(!this.is_init){this.dialog.style.setProperty("display","block");var titleSpan=this.dialog.getElementsByTagName("span")[0];titleSpan.innerHTML=text_UpgradeSuccess[g_lang];var h=0.5*(this.dialog.offsetHeight - this.dialogInner.offsetHeight);var w=0.5*(this.dialog.offsetWidth - this.dialogInner.offsetWidth);this.dialogInner.style.setProperty('left',w+'px');this.dialogInner.style.setProperty('top',h+'px');this.is_init=true;}else{this.dialog.style.setProperty("display","block");}},f_8: function(){this.dialog.style.setProperty("display","none");}};const UpgradeFailedDialog={is_init: false,dialog: document.getElementById("dialog-upgrade-failed"),dialogInner: document.getElementById("dialog-upgrade-failed-inner"),f_4: function(){if(!this.is_init){this.dialog.style.setProperty("display","block");var titleSpan=this.dialog.getElementsByTagName("span")[0];titleSpan.innerHTML=text_UpgradeFailed[g_lang];var h=0.5*(this.dialog.offsetHeight - this.dialogInner.offsetHeight);var w=0.5*(this.dialog.offsetWidth - this.dialogInner.offsetWidth);this.dialogInner.style.setProperty('left',w+'px');this.dialogInner.style.setProperty('top',h+'px');this.is_init=true;}else{this.dialog.style.setProperty("display","block");}},f_8: function(){this.dialog.style.setProperty("display","none");}};var LogDescDialog={is_init: false,log_desc: "",dialog: document.getElementById("log-desc-dlg"),innerDialog: document.getElementById("log-desc-dlg-inner"),content: document.getElementById("log-desc-content"),f_4: function(){if(!this.is_init){var titleSpan=this.dialog.getElementsByTagName("span")[0];titleSpan.innerHTML=text_InputLogDesc[g_lang];this.content.placeholder=text_text_InputLogDescHint[g_lang];var okBtn=this.dialog.getElementsByTagName("button")[0];okBtn.innerText=text_OK[g_lang];this.is_init=true;this.dialog.onclick=function(e){e.stopPropagation();document.getElementById("log-desc-dlg").style.setProperty("display","none");};this.innerDialog.onclick=function(e){e.stopPropagation();};}this.dialog.style.setProperty("display","block");menuObject.f_8()},f_8: function(){this.dialog.style.setProperty("display","none");},f_15: function(){return this.content.value.trim();},f_16: function(){this.content.value="";}};var DevInfos={resolution: "",userAgent: "",lang: "",fingerprint: "",f_17: function(){var w=window.screen.width * f_18()/100;var h=window.screen.height * f_18()/100;this.resolution=""+w+"x"+h;this.userAgent=navigator.userAgent;this.lang=this.f_19();this.fingerprint=f_20(this.lang+"#"+navigator.userAgent);},f_19: function(){var language=navigator.browserLanguage;if(!language){language=navigator.language;}if(!language){language=navigator.systemLanguage;}if(!language){language=navigator.userLanguage;}return language;},f_21: function(){return this.userAgent;}};var BoxInfos={boxVer: "",boxMac: "",boxManufacturer: "",boxUUID: "",boxOldUUID: "",boxType: "",carModel: "",carManufacturer: "",carOemName: "",carResolution: "",boxCheckCode: "",productType: "",f_17: function(uuid,oldUuid,manufacturer,carManufacturer,carModel,carOemName,carResolution,productType){this.boxUUID =uuid;this.boxOldUUID =oldUuid;this.boxManufacturer=manufacturer;this.carManufacturer=carManufacturer;this.carModel =carModel;this.carOemName =carOemName;this.carResolution =carResolution;this.productType =productType;},f_22: function(uuid,oldUuid,manufacturer,code,boxType,productType){this.boxUUID =uuid;this.boxOldUUID =oldUuid;this.boxManufacturer=manufacturer;this.boxCheckCode =code;this.boxType =boxType;this.productType =productType;},f_23: function(ver){this.boxVer=ver;},f_24: function(mac){this.boxMac=mac;}};var ActivateDialog={isInit: false,dialog: document.getElementById("activate-dlg"),innerDialog: document.getElementById("activate-dlg-inner"),select: null,accountElement: null,passwordElement: null,batchElement: null,checkbox: null,f_4: function(){if(!this.isInit){var okBtn=this.dialog.getElementsByTagName("button")[0];okBtn.innerText=text_Activation[g_lang];var spans=this.dialog.getElementsByTagName("span");spans[0].innerText=text_ProductActivation[g_lang];spans[1].innerText=text_Batch[g_lang];spans[2].innerText=text_Type[g_lang];spans[3].innerText=text_Account[g_lang];spans[4].innerText=text_Password[g_lang];spans[6].innerText=text_RememberPassword[g_lang];this.select=this.dialog.getElementsByTagName("select")[0];this.batchElement=this.dialog.getElementsByTagName("input")[0];this.accountElement=this.dialog.getElementsByTagName("input")[1];this.passwordElement=this.dialog.getElementsByTagName("input")[2];var date=new Date();var year=date.getFullYear();var month=date.getMonth()+1;if(month <= 9){month="0"+month;}var day=date.getDate();if(day <= 9){day="0"+day;}this.batchElement.value=year+month+day+CookieUtils.f_10("BATCH")[1];var lastAccount=CookieUtils.f_12();this.accountElement.value=lastAccount[0];this.passwordElement.value=lastAccount[1];this.checkbox=this.dialog.getElementsByTagName("input")[3];this.checkbox.checked=CookieUtils.f_14();document.getElementById("view").setAttribute('content','user-scalable=no');this.isInit=true;var that=this;this.dialog.onclick=function(e){e.stopPropagation();that.dialog.style.setProperty("display","none");var btn=document.getElementById("down-button");btn.innerHTML=text_UploadLog[g_lang];btn.onclick=function(){LogDescDialog.f_4();};document.getElementById("menu-button").style.setProperty("display","none");};this.innerDialog.onclick=function(e){e.stopPropagation();};}this.dialog.style.setProperty("display","block");},f_8: function(){this.dialog.style.setProperty("display","none");document.getElementById("view").setAttribute('content','user-scalable=yes');},f_25: function(){var account=this.accountElement.value.trim();var re=/^[a-zA-Z][a-zA-Z0-9\.]{2,20}$/;if(!re.test(account)){CookieUtils.f_11(account);account="";this.accountElement.value="";}var password=this.passwordElement.value.trim();re=/^[a-zA-Z0-9]{4,16}$/;if(!re.test(password)){password="";this.passwordElement.value="";CookieUtils.f_11(account);}var batch=this.batchElement.value.trim();if(batch.length != 12){batch="";}return [this.select.options[this.select.selectedIndex].value,this.select.options[this.select.selectedIndex].innerHTML,account,password,batch];},f_26: function(name,pwd){this.accountElement.value=name;this.passwordElement.value=pwd;},f_14: function(){return this.checkbox.checked;},f_27: function(carTypeInfo){for (var i in carTypeInfo){var type=carTypeInfo[i]["car_type"];var desc=carTypeInfo[i]["car_type_desc"];var option=document.createElement("option");option.value=type;option.innerHTML=desc;this.select.appendChild(option);}},};var ProgressDialog={isInit: false,isCanHide: false,dialog: document.getElementById('dialog'),dialogInner: document.getElementById('dialog-inner'),f_4: function(){this.isCanHide=false;this.dialog.style.setProperty('display','block');if(!this.isInit){var h=0.5*(this.dialog.offsetHeight - this.dialogInner.offsetHeight);var w=0.5*(this.dialog.offsetWidth - this.dialogInner.offsetWidth);this.dialogInner.style.setProperty('left',w+'px');this.dialogInner.style.setProperty('top',h+'px');var obj=this;this.dialog.onclick=function(e){obj.f_8();e.stopPropagation();};this.dialogInner.onclick=function(e){e.stopPropagation();};}},f_8: function(){if(this.isCanHide){this.dialog.style.setProperty('display','none');}},f_28: function(){this.dialog.style.setProperty('display','none');},f_29: function(is){this.isCanHide=is;}};
function f_1(){f_30();DevInfos.f_17();f_31();f_32("get_box_mode");f_32("get_log_state");}
function f_30(){g_lang=f_19();document.getElementById("loader-tips").innerText=text_CheckingUpdate[g_lang];};
function f_6(obj){var batch=obj.value;if(batch.length==12){var substr=batch.substring(8);CookieUtils.f_9("BATCH",substr);}else{Toast(text_BatchInvalid[g_lang]);}}
function f_31(){var loader=document.getElementById("loader");loader.style.setProperty("display","block");var url="/cgi-bin/server.cgi?cmd=is_box_activated";var xmlhttp=new XMLHttpRequest();xmlhttp.open("GET",url,true);xmlhttp.onreadystatechange=function(){if(xmlhttp.readyState==4){if(xmlhttp.status==200){var data=JSON.parse(xmlhttp.responseText);if(data.productType==undefined){data.productType="";}BoxInfos.f_17(data.uuid,data.old_uuid,data.manufacturer,data.carManufacturer,data.carModel,data.carOemName,data.carResolution,data.productType);var isActivated=data.isActivated;if(isActivated=='1'){f_33();}else{BoxInfos.f_22(data.uuid,data.old_uuid,data.manufacturer,data.code,data.boxType,data.productType);f_34(data.uuid,data.old_uuid,data.manufacturer,data.code,data.boxType,data.productType);}}else{Toast("[i]"+text_NetworkException[g_lang]+"("+xmlhttp.status+")");}}};xmlhttp.send(null);}
function f_7(){var info=ActivateDialog.f_25();var account =info[2];var password=info[3];var batch=info[4];if(batch==""){Toast(text_BatchInvalid[g_lang]);}else if(account=='' || password==''){Toast(text_AccountOrPwdInvalid[g_lang]);}else{if(ActivateDialog.f_14()){CookieUtils.f_13(true);CookieUtils.f_9(account,password);}else{CookieUtils.f_13(false);CookieUtils.f_11(account);}var url=URL_PREFIX+"box_manage.php";var postData=new FormData();postData.append("action","RequestActivateBox");postData.append("uuid",BoxInfos.boxUUID);postData.append("manufacturer",BoxInfos.boxManufacturer);postData.append("box_type",BoxInfos.boxType);postData.append("session_id",BoxInfos.boxCheckCode);postData.append("activate_device_infos",DevInfos.f_21());postData.append("account",account);postData.append("password",password);postData.append("car_type",info[0]);postData.append("product_type",BoxInfos.productType);postData.append("batch",batch);postData.append("fingerprint",DevInfos.fingerprint);postData.append("resolution",DevInfos.resolution);var xmlhttp=new XMLHttpRequest();xmlhttp.open("POST",url,true);xmlhttp.onreadystatechange=function(){if(xmlhttp.readyState==4){if(xmlhttp.status==200){var responseText=xmlhttp.responseText.trim();var text=responseText.split("$");var data=JSON.parse(text[1]);var errCode=Number(data["error_code"]);if(errCode==0){var carBrands ="";var carBrandsZh="";for (var i in data.car_brands){carBrands =carBrands +data.car_brands[i].car_brand +",";carBrandsZh=carBrandsZh+data.car_brands[i].car_brand_zh+",";}Toast(text_ActivateSuccess[g_lang]);ActivateDialog.f_8();f_35(data.session_id,carBrands,carBrandsZh,data.r);f_33();}else if(errCode==4){Toast(text_AccountOrPwdError[g_lang]);}else{Toast(text_NotActivated[g_lang]+"("+errCode+")");}}else{Toast("[R]"+text_NetworkException[g_lang]);}}};xmlhttp.send(postData);}}
function f_34(uuid,oldUuid,manufacturer,checkCode,boxType,productType){var url=URL_PREFIX+"box_manage.php";var postData=new FormData();postData.append("action","CheckBoxIsActivated");postData.append("uuid",uuid);postData.append("old_uuid",oldUuid);postData.append("manufacturer",manufacturer);postData.append("box_type",boxType);postData.append("session_id",checkCode);postData.append("lang",f_19());postData.append("product_type",productType);var xmlhttp=new XMLHttpRequest();xmlhttp.open("POST",url,true);xmlhttp.onreadystatechange=function(){if(xmlhttp.readyState==4){if(xmlhttp.status==200){var responseText=xmlhttp.responseText.trim();var text=responseText.split("$");var data=JSON.parse(text[1]);var is_activated=Number(data.is_activated);if(is_activated != 1){var loader=document.getElementById("loader");loader.style.setProperty("display","none");ActivateDialog.f_4();ActivateDialog.f_27(data["car_type_info"]);}else{var carBrands ="";var carBrandsZh="";for (var i in data.car_brands){carBrands =carBrands +data.car_brands[i].car_brand +",";carBrandsZh=carBrandsZh+data.car_brands[i].car_brand_zh+",";}f_35(data.session_id,carBrands,carBrandsZh,data.r);f_33();}}else{var loader=document.getElementById("loader");loader.style.setProperty("display","none");var span=document.getElementById("update-head-title");span.innerHTML=text_NetworkException[g_lang];}}};xmlhttp.send(postData);}
function f_35(code,carBrands,carBrandsZh,r){var url="/cgi-bin/server.cgi";var postData=new FormData();postData.append("cmd", "box_activated");postData.append("code", code);postData.append("car_brands", carBrands);postData.append("car_brands_zh",carBrandsZh);postData.append("r", r);var xmlhttp=new XMLHttpRequest();xmlhttp.open("POST",url,true);xmlhttp.onreadystatechange=function(){if(xmlhttp.readyState==4){if(xmlhttp.status==200){if(xmlhttp.responseText != "1"){var btn=document.getElementById("bottom-button");btn.style.setProperty("display","none");var span=document.getElementById("update-head-title");span.innerHTML=text_NotActivated[g_lang]+"("+22+")";ActivateDialog.f_4();Toast(text_NotActivated[g_lang]+"(22)");}}else{}}};xmlhttp.send(postData);}
function f_33(){var loader=document.getElementById("loader");loader.style.setProperty("display","block");var url="/cgi-bin/server.cgi?cmd=getversion";var xmlhttp=new XMLHttpRequest();xmlhttp.open("GET",url,true);xmlhttp.onreadystatechange=function(){if(xmlhttp.readyState==4){if(xmlhttp.status==200){var data=JSON.parse(xmlhttp.responseText);var type=data.type;var userType="p";var boxType="";var boxMac=data.boxMac;boxMac=boxMac.replace(/\:/g,"");if(type.length >= 2){userType=type[0];boxType=type[1];g_boxLogFileName=boxMac+"_box_"+userType+boxType+".log";}else{userType=type;g_boxLogFileName=boxMac+"_box"+".log";}g_boxVersion=data.version+"_"+data.type;BoxInfos.f_23(g_boxVersion);BoxInfos.f_24(data.boxMac);f_36();f_37(data.version,userType,boxType,data.fileName);}else{}}};xmlhttp.send(null);}
function f_38(){var date=new Date();var year=date.getFullYear();var month=date.getMonth()+1;var day=date.getDate();var hour=date.getHours();var minute=date.getMinutes();var second=date.getSeconds();return ""+year+"-"+month+"-"+day+" "+hour+":"+minute+":"+second;}
function f_36(){var form=new FormData();form.append("action","BoxOnline");form.append("uuid",BoxInfos.boxUUID);form.append("box_version",BoxInfos.boxVer);form.append("box_manufacturer",BoxInfos.boxManufacturer);form.append("car_manufacturer",BoxInfos.carManufacturer);form.append("car_model",BoxInfos.carModel);form.append("car_oem_name",BoxInfos.carOemName);form.append("car_resolution",BoxInfos.carResolution);form.append("device_infos",DevInfos.f_21());form.append("local_time",f_38());form.append("device_resolution",DevInfos.resolution);form.append("device_language",DevInfos.lang);var url=URL_PREFIX+"box_manage.php";var xmlhttp=new XMLHttpRequest();xmlhttp.open("POST",url,true);xmlhttp.onreadystatechange=function(){if(xmlhttp.readyState==4){if(xmlhttp.status==200){var responseText=xmlhttp.responseText.trim();var text=responseText.split("$");var data=JSON.parse(text[1]);var is_activated=Number(data.is_activated);if(is_activated != 1){ActivateDialog.f_4();var url="/cgi-bin/server.cgi?cmd=box_not_activated";var boaXmlHttp=new XMLHttpRequest();boaXmlHttp.open("GET",url,true);boaXmlHttp.onreadystatechange=function(){if(boaXmlHttp.readyState==4){if(boaXmlHttp.status==200){}else{}}};boaXmlHttp.send(null);}}else{}}};xmlhttp.send(form);}
function f_37(curVer,userType,boxType,fileName){var url=URL_PREFIX+"server.php?action=checkBoxUpdateByCustomerBoxType"+ "&lang="+f_19()+ "&CustomerType="+userType+ "&BoxType="+boxType+ "&uuid="+BoxInfos.boxUUID+ "&fileName="+fileName+"&curVer="+curVer;var xhr=new XMLHttpRequest();xhr.open("GET",url,true);xhr.timeout=8000;xhr.onreadystatechange=function(){if(xhr.readyState==4){var loader=document.getElementById("loader");loader.style.setProperty("display","none");if(xhr.status==200){var responseText=xhr.responseText.trim();if(responseText==""){g_downUrl="";f_39("",curVer,0);return;}var txt=responseText.split('$');if(txt.length < 2){g_downUrl="";f_39("",curVer,0);return;}var data=JSON.parse(txt[1]);var updateLog=data['updateLog'];var fileSize=data['fileSize'];var fileName=data['fileName'];if(f_40(curVer,data.version) >= 0){g_downUrl="";f_39("",curVer,0);}else{g_boxFileName=fileName;g_downUrl=URL_PREFIX+"server.php?action=downfile&filename="+fileName+"&filepath="+data.filePath;f_39(updateLog,data.version,fileSize);}}else{g_downUrl="";f_39("",curVer,-1);}}};xhr.send(null);};
function f_39(updateLog,version,fileSize){if(fileSize==0){var div=document.getElementById("div-update-head");div.setAttribute("class","div-update-head-center");div.setAttribute("className","div-update-head-center");var btn=document.getElementById("down-button");btn.innerHTML=text_CheckUpdate[g_lang];var span=document.getElementById("update-head-title");span.innerHTML=text_AlreadyLatestVersion[g_lang];var span1=document.getElementById("update-head-version");span1.innerHTML="VER:"+ version;}else if(fileSize>0){var div=document.getElementById("div-update-head");div.setAttribute("class","div-update-head-left");div.setAttribute("className","div-update-head-left");var btn=document.getElementById("down-button");btn.innerHTML=text_UpdateNow[g_lang];var span=document.getElementById("update-head-title");span.innerHTML=text_DiscoverNewVersion[g_lang];var span1=document.getElementById("update-head-version");span1.innerHTML=text_Version[g_lang]+":"+version+" | "+text_Size[g_lang]+":"+(fileSize / (1024 * 1024)).toFixed(2)+"MB";var dlgContent=document.getElementById("release-notes");dlgContent.innerHTML="";dlgContent.style.setProperty("text-align","left");var span0=document.createElement("span");dlgContent.appendChild(span0);span0.innerHTML=text_ReleaseNotes[g_lang]+":";var ul=document.createElement("ul");dlgContent.appendChild(ul);var logs=updateLog.split("\n");for (var i in logs){var li=document.createElement("li");ul.appendChild(li);li.innerHTML=logs[i];}}else if( fileSize < 0){var div=document.getElementById("div-update-head");div.setAttribute("class","div-update-head-center");div.setAttribute("className","div-update-head-center");var btn=document.getElementById("down-button");btn.innerHTML=text_CheckUpdate[g_lang];var dlgContent=document.getElementById("release-notes");dlgContent.innerHTML="";dlgContent.style.setProperty("text-align","center");var span0=document.createElement("span");dlgContent.appendChild(span0);span0.innerHTML=text_NetworkException[g_lang];}}
function f_2(){if(g_downUrl==""){f_33();return;}ProgressDialog.f_4();var xhr=new XMLHttpRequest();xhr.open("GET",g_downUrl,true);xhr.responseType="arraybuffer";xhr.onprogress=onProgress;xhr.onload=function(e){var buf=xhr.response;if(buf){f_41(buf);}};xhr.send(null);}
function f_41(buf){ProgressDialog.f_28();UpgradingDialog.f_4();g_intervalId=setInterval(getUpgradeState,500);var fileObj=new File([buf],g_boxFileName,{type:"application/octet-stream"});var form=new FormData();form.append("file",fileObj);var xhrSend=new XMLHttpRequest();xhrSend.open("post","/cgi-bin/upload.cgi",true);xhrSend.upload.onprogress=onProgress;xhrSend.onload=function(evt){var data=JSON.parse(evt.target.responseText);if(Number(data.code) != 0){f_42(UPGRADE_STATE_FAILED,data.msg);}};xhrSend.send(form);}
function onProgress(evt){var percent=Math.round(evt.loaded / evt.total * 100);var curRate=document.getElementById("curRate");curRate.style.setProperty("width",percent+"%");var span=document.getElementById("progress-percent");span.innerText=percent+"%";}
function f_42(state,msg){if(state==UPGRADE_STATE_UPGRADING){UpgradingDialog.f_4();}else if(state==UPGRADE_STATE_SUCCESS){clearInterval(g_intervalId);UpgradingDialog.f_8();UpgradeSuccessDialog.f_4();}else if(state==UPGRADE_STATE_FAILED){clearInterval(g_intervalId);UpgradingDialog.f_8();UpgradeFailedDialog.f_4();}else{}}
function getUpgradeState(){var url="/cgi-bin/server.cgi?cmd=getupgradestate";var xmlhttp=new XMLHttpRequest();xmlhttp.open("GET",url,true);xmlhttp.onreadystatechange=function(){if(xmlhttp.readyState==4){if(xmlhttp.status==200){var data=JSON.parse(xmlhttp.responseText);f_42(data.state,data.errCode);}else if(xmlhttp.status==0){f_42(UPGRADE_STATE_SUCCESS,"");}else{f_42(UPGRADE_STATE_FAILED,""+xmlhttp.status);}}};xmlhttp.send(null);}
function f_43(){var content=LogDescDialog.f_15();var len=content.length;if(len>140){Toast(text_InputContentExceeds[g_lang]);return false;}if(len < 1){Toast(text_InputLogDescIllegal[g_lang]);return false;}var patrn=/^[0-9]*$/;if(patrn.test(content)){Toast(text_InputLogDescIllegal[g_lang]);return false;}patrn=/^[a-zA-Z]*$/;if(patrn.test(content)){Toast(text_InputLogDescIllegal[g_lang]);return false;}return true;}
function f_5(){if(!f_43()){return;}else{LogDescDialog.f_8();}var xhr=new XMLHttpRequest();xhr.open("GET","/cgi-bin/server.cgi?cmd=upload_log",true);xhr.responseType="arraybuffer";ProgressDialog.f_4();xhr.onprogress=onUploadProgress;xhr.onload=function(e){var buf=xhr.response;if(buf && buf.byteLength>0){f_44(buf);}else{var titleDiv=document.getElementById("dialog-message");titleDiv.innerHTML=text_LogFileNotExist[g_lang];}};xhr.send(null);}
function f_44(buf){var titleDiv=document.getElementById("dialog-message");titleDiv.innerHTML=text_Uploading[g_lang];var info ="###### www Log ######\n";info += DevInfos.resolution+"\n";info += DevInfos.fingerprint+"\n\n";var fileObj=new File([info,buf],g_boxLogFileName,{type:"application/octet-stream"});var form=new FormData();form.append("log_file",fileObj);form.append("appVersion",g_boxVersion);form.append("logDesc",LogDescDialog.f_15());form.append("manufacturer",BoxInfos.carManufacturer);form.append("model",BoxInfos.carModel);form.append("platform",BoxInfos.carOemName);form.append("resolution",BoxInfos.carResolution);form.append("uuid",BoxInfos.boxUUID);var xhrSend=new XMLHttpRequest();var url=URL_PREFIX+"upload_log.php";xhrSend.open("post",url,true);xhrSend.upload.onprogress=onUploadProgress;xhrSend.onload=function(evt){var responseText=evt.target.responseText;var arResult=responseText.split("$");if(arResult.length>0){var data=JSON.parse(arResult[1]);if(data.error){titleDiv.innerHTML=text_UploadFailed[g_lang];}else{titleDiv.innerHTML=text_UploadSuccess[g_lang];ProgressDialog.f_29(true);LogDescDialog.f_16();}}};xhrSend.send(form);}
function onUploadProgress(evt){var percent=0;if(evt.total>0){percent=Math.round(evt.loaded / evt.total * 100);}var curRate=document.getElementById("curRate");curRate.style.setProperty("width",percent+"%");var span=document.getElementById("progress-percent");span.innerText=percent+"%";}
function f_32(cmd){var url="/cgi-bin/server.cgi?cmd="+cmd;var xmlhttp=new XMLHttpRequest();xmlhttp.open("GET",url,true);xmlhttp.onreadystatechange=function(){if(xmlhttp.readyState==4){if(xmlhttp.status==200){if("get_box_mode"==cmd){var obj=document.getElementById("menu-div").children[0].children[0].children[0];if(xmlhttp.responseText=="1"){obj.innerHTML=text_CloseUMode[g_lang];obj.onclick=function(){f_45("close_u_mode");};}else{obj.innerHTML=text_OpenUMode[g_lang];obj.onclick=function(){f_45("open_u_mode");};}}else if("get_log_state"==cmd){var obj=document.getElementById("menu-div").children[0].children[1].children[0];if(xmlhttp.responseText=="1"){obj.innerHTML=text_CloseLog[g_lang];obj.onclick=function(){f_45("close_log");};}else{obj.innerHTML=text_OpenLog[g_lang];obj.onclick=function(){f_45("open_log");};}}}else{}}};xmlhttp.send(null);}
function f_45(cmd){var url="/cgi-bin/server.cgi?cmd="+cmd;var xmlhttp=new XMLHttpRequest();xmlhttp.open("GET",url,true);xmlhttp.onreadystatechange=function(){if(xmlhttp.readyState==4){if(xmlhttp.status==200){if("open_u_mode"==cmd){var obj=document.getElementById("menu-div").children[0].children[0].children[0];obj.innerHTML=text_CloseUMode[g_lang];obj.onclick=function(){f_45("close_u_mode");};}else if("close_u_mode"==cmd){var obj=document.getElementById("menu-div").children[0].children[0].children[0];obj.innerHTML=text_OpenUMode[g_lang];obj.onclick=function(){f_45("open_u_mode");};}else if("open_log"==cmd){var obj=document.getElementById("menu-div").children[0].children[1].children[0];obj.innerHTML=text_CloseLog[g_lang];obj.onclick=function(){f_45("close_log");};}else if("close_log"==cmd){var obj=document.getElementById("menu-div").children[0].children[1].children[0];obj.innerHTML=text_OpenLog[g_lang];obj.onclick=function(){f_45("open_log");};}}else{}}};xmlhttp.send(null);}
function f_19(){var language=navigator.browserLanguage?navigator.browserLanguage:navigator.language;var lang=language.toLowerCase();if(lang.indexOf('zh-cn')>-1){langIndex=0;}else if(lang.indexOf('zh-tw')>-1){langIndex=1;}else if(lang.indexOf('en')>-1){langIndex=2;}else{langIndex=2;}return langIndex;}
function f_40(v1,v2){v1=v1.split('.');v2=v2.split('.');const len=Math.min(v1.length,v2.length);for (let i=0; i < len; i++){const num1=parseInt(v1[i]);const num2=parseInt(v2[i]);if(num1>num2){return 1;}else if(num1 < num2){return -1;}}return 0;}
function f_18(){var ratio=100,screen=window.screen,ua=navigator.userAgent.toLowerCase();if(window.devicePixelRatio !== undefined){ratio=window.devicePixelRatio;}else if(~ua.indexOf('msie')){if(screen.deviceXDPI && screen.logicalXDPI){ratio=screen.deviceXDPI / screen.logicalXDPI;}}else if(window.outerWidth !== undefined && window.innerWidth !== undefined){ratio=window.outerWidth / window.innerWidth;}if(ratio){ratio=Math.round(ratio * 100);}return ratio;}
function Toast(msg){var duration=3000;var p=document.createElement('div');p.style.cssText="width:100%; text-align:center; position:absolute; top:90%; z-index:999999;";document.body.appendChild(p);var m=document.createElement('span');m.innerHTML=msg;m.style.cssText="min-width:40%; opacity:0.7; padding-top:1.5rem; padding-bottom:1.5rem; padding-left:2.5rem; padding-right:2.5rem; color:#121212; text-align:center; border-radius:0.8rem; background:#FFFFFF; font-size: 2rem;";p.appendChild(m);setTimeout(function(){var d=0.5;m.style.webkitTransition='-webkit-transform '+d+'s ease-in,opacity '+d+'s ease-in';m.style.opacity='0';setTimeout(function(){p.removeChild(m);document.body.removeChild(p)},d * 1000);},duration);}
function f_20(text){var canvas=document.createElement('canvas');if(!!(canvas.getContext && canvas.getContext('2d'))){var ctx=canvas.getContext('2d');ctx.textBaseline="top";ctx.font="14px 'Arial'";ctx.textBaseline="alphabetic";ctx.fillStyle='#FF0000';ctx.fillRect(0,0,8,10);ctx.fillStyle="#f60";ctx.fillRect(125,1,62,20);ctx.fillStyle="#069";ctx.fillText(text,2,15);ctx.fillStyle="rgba(102,204,0,0.7)";ctx.fillText(text,4,17);var b64=canvas.toDataURL().replace('data:image/png;base64,','');var bin=window.atob(b64);return crc=bin2hex(bin.slice(-16,-12));}else{return '';}}
function bin2hex(s){var i,l,o='',n;s += '';for (i=0,l=s.length; i < l; i++){n=s.charCodeAt(i).toString(16);o += n.length < 2 ? '0'+n : n;}return o;}</script></body></html>